{% extends 'admin_base.html' %}

{% block page_title %}Selesai Detail{% endblock %}
{% block page_heading %}Selesai Detail{% endblock %}

{% block breadcrumbs %}
<li class="breadcrumb-item">Task</li>
<li class="breadcrumb-item"><a href="/projects/task/selesai">Selesai</a></li>
<li class="breadcrumb-item active">Detail</li>
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h3 class="card-title">Owner</h3>
         <div class="card-tools">
          <a href="/projects/task/selesai" class="btn btn-sm btn-secondary">Back</a>
        </div>
      </div>
      <div class="card-body">
        {% if partner %}
        <div class="mb-3">
          <div class="h5 mb-2">{{ partner.partner_name }}</div>
          <div class="badge badge-primary mr-2"><i class="bi bi-phone"></i> {{ partner.partner_contact }}</div>
          {% if partner.partner_region %}<div class="badge badge-info mr-2">{{ partner.partner_region }}</div>{% endif %}
          {% if partner.request_date %}<div class="badge badge-warning mr-2">Request: {{ partner.request_date|date:'d M Y' }}</div>{% endif %}
          {% if partner.pic %}<div class="badge badge-secondary">PIC: {{ partner.pic }}</div>{% endif %}
        </div>
        {% endif %}
        <div class="row">
          <div class="col-md-4 mb-3">
            <div class="card border-info">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>Domain</div>
                  <div class="h4 mb-0">{{ domains|length }}</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card border-primary">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>Subdomain</div>
                  <div class="h4 mb-0">{{ subdomains|length }}</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 mb-3">
            <div class="card border-success">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>FB Ads</div>
                  <div class="h4 mb-0">{{ fb_ads|length }}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          {% for d in domains %}
          <div class="col-md-6">
            <div class="card mb-3">
              <div class="card-header d-flex justify-content-between align-items-center">
                <div class="h5 mb-0">{{ d.domain }}</div>
                <div>
                  <span class="badge badge-info mr-1">{{ d.provider_name|default_if_none:"-" }}</span>
                  <span class="badge badge-secondary">{{ d.registrar_name|default_if_none:"-" }}</span>
                </div>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-5">
                    <div class="small text-muted">Server</div>
                    <div>{{ d.hostname|default_if_none:"-" }}</div>
                    <div>{{ d.label|default_if_none:"-" }}</div>
                  </div>
                  <div class="col-md-7">
                    <div class="small text-muted">Website</div>
                    <div>{{ d.w_domain|default_if_none:"-" }}</div>
                    <div>{{ d.website|default_if_none:"-" }}</div>
                    <div>User: {{ d.website_user|default_if_none:"-" }}</div>
                    <div>Pass: {{ d.website_pass|default_if_none:"-" }}</div>
                    <div class="mt-2">
                      <span class="badge badge-warning">{{ d.article_status|default_if_none:"-" }}</span>
                      {% if d.article_deadline %}<span class="badge badge-light">Deadline {{ d.article_deadline|date:'Y-m-d' }}</span>{% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="col-12">
            <div class="text-center text-muted">Belum ada domain terkait.</div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="card-title">Subdomain & Server</h3>
      </div>
      <div class="card-body">
        <div class="row">
          {% for s in subdomains %}
          <div class="col-md-6">
            <div class="card mb-3">
              <div class="card-header">
                <h3 class="card-title">{{ s.subdomain }}.{{ s.domain }}</h3>
                <div class="card-tools">
                  <span class="badge badge-info">Cloudflare: {{ s.cloudflare|default_if_none:"-" }}</span>
                </div>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <div class="small text-muted">Server</div>
                    <div>{{ s.public_ipv4|default_if_none:"-" }}</div>
                    <div>Hostname: <b>{{ s.hostname|default_if_none:"-" }}</b></div>
                    <div>Label: <b>{{ s.label|default_if_none:"-" }}</b></div>
                  </div>
                  <div class="col-md-6">
                    <div class="small text-muted">Website</div>
                    <div>{{ s.website|default_if_none:"-" }}</div>
                    <div>User: {{ s.website_user|default_if_none:"-" }}</div>
                    <div>Pass: {{ s.website_pass|default_if_none:"-" }}</div>
                    <div class="mt-2">
                      <span class="badge badge-warning">{{ s.article_status|default_if_none:"-" }}</span>
                      {% if s.article_deadline %}<span class="badge badge-danger">Deadline {{ s.article_deadline|date:'d M Y' }}</span>{% endif %}
                    </div>
                  </div>
                </div>
                <hr>
                <div class="row">
                  <div class="col-md-6">
                    <div class="small text-muted">Tracker</div>
                    <small>Keitaro: <b>{{ s.tracker|default_if_none:"-" }}</b></small><br>
                    <small>Params: <b>{{ s.tracker_params|default_if_none:"-" }}</b></small>
                  </div>
                  <div class="col-md-6">
                    <div class="small text-muted">Plugin</div>
                    <small>Setup: {{ s.plugin_setup|default_if_none:"-" }}</small><br>
                    <small>LP: <b>{{ s.plugin_lp|default_if_none:"-" }}</b></small><br>
                    <small>Params: <b>{{ s.plugin_params|default_if_none:"-" }}</b></small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="col-12">
            <div class="text-center text-muted">Belum ada subdomain terkait.</div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="card-title">FB Ads Campaign</h3>
      </div>
      <div class="card-body">
        <div class="row">
          {% for a in fb_ads %}
          <div class="col-md-6">
            <div class="card mb-3">
              <div class="card-header">
                <h3 class="card-title">
                  {{ a.subdomain_name|default_if_none:a.domain }}<br>
                  <div class="small text-muted">{{ a.account_name|default_if_none:"-" }}</div>
                </h3>
                <div class="card-tools">
                  <span class="badge {% if a.status == 'off' %}badge-secondary{% else %}badge-success{% endif %}">{{ a.status|default_if_none:"-" }}</span>
                </div>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <div class="small text-muted">Fanpage</div>
                    <div>{{ a.fanpage|default_if_none:"-" }}</div>
                  </div>
                  <div class="col-md-6">
                    <div class="small text-muted">Interest</div>
                    <div>{{ a.interest|default_if_none:"-" }}</div>
                  </div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-6">
                    <div class="small text-muted">Country</div>
                    <div><small>{{ a.country|default_if_none:"-" }}</small></div>
                  </div>
                  <div class="col-md-6">
                  <div class="small text-muted">Daily Budget</div>
                    <div><span class="fmt-idr" data-amount="{{ a.daily_budget|default:'0' }}"></span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="col-12">
            <div class="text-center text-muted">Belum ada data FB Ads.</div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h3 class="card-title">Data Proses</h3>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th width="5%">No</th>
                <th width="15%">Task</th>
                <th width="10%">Process</th>
                <th width="25%">Catatan</th>
                <th width="10%">Dibuat Oleh</th>
                <th width="10%">Dibuat Pada</th>
                <th width="10%">Selesai Oleh</th>
                <th width="10%">Selesai Pada</th>
              </tr>
            </thead>
            <tbody>
              {% for p in processes %}
              <tr>
                <td class="align-middle">{{ forloop.counter }}</td>
                <td class="align-middle">{{ p.task_name|default_if_none:"-" }}</td>
                <td class="align-middle">
                  <span class="badge {% if p.process_st == 'waiting' %}badge-warning{% elif p.process_st == 'approve' %}badge-success{% elif p.process_st == 'reject' %}badge-danger{% else %}badge-secondary{% endif %}">
                    {{ p.process_st|default_if_none:"-" }}
                  </span>
                </td>
                <td class="align-middle">{{ p.catatan|default_if_none:"-" }}</td>
                <td class="align-middle">{{ p.mdb_name|default_if_none:"-" }}</td>
                <td class="align-middle">{% if p.mdd %}{{ p.mdd|date:'d M Y H:i' }}{% else %}-{% endif %}</td>
                <td class="align-middle">{{ p.mdb_finish_name|default_if_none:"-" }}</td>
                <td class="align-middle">{% if p.mdd_finish %}{{ p.mdd_finish|date:'d M Y H:i' }}{% else %}-{% endif %}</td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="9" class="text-center text-muted">Belum ada data proses.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
{% block more_scripts %}
<script>
try {
  document.querySelectorAll('.fmt-idr').forEach(function(el){
    var amt = parseFloat(String(el.getAttribute('data-amount') || '0').replace(/[^0-9.-]/g,'')) || 0;
    var fmt = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(amt);
    el.textContent = fmt;
  });
} catch(e) {
  document.querySelectorAll('.fmt-idr').forEach(function(el){
    var amt = parseFloat(String(el.getAttribute('data-amount') || '0').replace(/[^0-9.-]/g,'')) || 0;
    var rounded = Math.round(amt);
    var str = String(rounded).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
    el.textContent = 'Rp ' + str;
  });
}
</script>
{% endblock %}
