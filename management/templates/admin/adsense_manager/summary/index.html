{% extends "admin_base.html" %}
{% load static %}
{% block page_title %}Adsense Manager{% endblock %}

{% block page_heading %}Adsense Manager{% endblock %}

{% block breadcrumbs %}
    <li class="breadcrumb-item"><a href="{% url 'dashboard_admin' %}">Dashboard</a></li>
    <li class="breadcrumb-item active">Adsense Manager</li>
{% endblock %}

{% block content %}
<div class="container-fluid py-3">
  <h4 class="mb-3">AdSense Summary</h4>
  <style>
    /* Tinggi grafik responsif dengan batas maksimum agar lebih proporsional */
    #chart_revenue_daily {
      height: clamp(180px, 28vh, 280px);
      max-height: 280px;
    }
    @media (max-width: 576px) {
      #chart_revenue_daily {
        height: 200px;
        max-height: 220px;
      }
    }
  </style>
  <!-- Flatpickr Datepicker -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <!-- Filters -->
  <div class="card mb-3">
    <div class="card-header">
        <h3 class="card-title">AdSense Summary</h3>
    </div> <!-- /.card-header -->
    <div class="card-body">
      <div id="overlay"
           style="
               display: none;
               position: fixed;
               top: 0; left: 0;
               width: 100%; height: 100%;
               background: rgba(0,0,0,0.5);
               z-index: 9999;
               text-align: center;
               color: white;
               font-size: 2rem;
               padding-top: 20%;">
          <i class="fas fa fa-sync-alt fa-spin"></i> Memuat Data Summary AdSense ...
      </div>
      <div class="row g-3 align-items-end">
        <div class="col-md-3">
          <label for="start_date" class="form-label">Range Dari</label>
          <input type="text" id="start_date" class="form-control datepicker-input" placeholder="YYYY-MM-DD" />
        </div>
        <div class="col-md-3">
          <label for="end_date" class="form-label">Range Sampai</label>
          <input type="text" id="end_date" class="form-control datepicker-input" placeholder="YYYY-MM-DD" />
        </div>
        <div class="col-md-4">
          <label for="account_filter" class="form-label">Filter Account</label>
          <select id="account_filter" class="form-control select2"></select>
        </div>
        <div class="col-md-2">
          <button id="btn_load_summary" class="btn btn-primary w-100">Load Data</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Summary boxes -->
  <div class="row g-3" id="summary_boxes">
    <div class="col-sm-6 col-lg-2">
      <div class="card text-center">
        <div class="card-body">
          <div class="text-muted">Impressions</div>
          <div id="sum_impressions" class="fs-5 fw-semibold">0</div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-2">
      <div class="card text-center">
        <div class="card-body">
          <div class="text-muted">Clicks</div>
          <div id="sum_clicks" class="fs-5 fw-semibold">0</div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-2">
      <div class="card text-center">
        <div class="card-body">
          <div class="text-muted">CTR</div>
          <div id="sum_ctr" class="fs-5 fw-semibold">0%</div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-2">
      <div class="card text-center">
        <div class="card-body">
          <div class="text-muted">CPC</div>
          <div id="sum_cpc" class="fs-5 fw-semibold">Rp.0</div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-2">
      <div class="card text-center">
        <div class="card-body">
          <div class="text-muted">eCPM</div>
          <div id="sum_ecpm" class="fs-5 fw-semibold">Rp.0</div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-lg-2">
      <div class="card text-center">
        <div class="card-body">
          <div class="text-muted">Revenue</div>
          <div id="sum_revenue" class="fs-5 fw-semibold">Rp.0</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Info message -->
  <div class="alert alert-info mt-3" id="summary_info" style="display:none"></div>

  <!-- Placeholder for future charts -->
  <div class="card mt-3">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <div class="text-muted">Grafik Pendapatan Harian</div>
        <small class="text-muted">Sumber: AdSense Reports</small>
      </div>
      <canvas id="chart_revenue_daily"></canvas>
    </div>
  </div>
</div>

<!-- Chart.js untuk grafik harian -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="{% static 'ajax/admin/adsense_manager/summary.js' %}"></script>
{% endblock %}
